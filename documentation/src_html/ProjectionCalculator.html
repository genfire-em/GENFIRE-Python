<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>..//GENFIRE/gui/ProjectionCalculator</title>
  <meta name="description" content="GENFIRE Documentation">
  <meta name="author" content="Alan (AJ) Pryor, Jr.">  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
<code><font color="orange">from </font>__future__ <font color="orange">import </font>print_function<br><br><font color="orange">from </font>PyQt4 <font color="orange">import </font>QtCore, QtGui<br><font color="orange">import </font>os<br><font color="orange">import </font><b><font color="orange">GENFIRE</font></b><br><font color="orange">import </font>pyfftw<br><font color="orange">import </font>numpy as np<br><font color="orange">import </font>matplotlib.pyplot as plt<br><font color="orange">from </font>matplotlib.backends.backend_qt4agg <font color="orange">import </font>FigureCanvasQTAgg as FigureCanvas<br><font color="orange">from </font>matplotlib.backends.backend_qt4agg <font color="orange">import </font>NavigationToolbar2QT as NavigationToolbar<br><font color="orange">import </font>ProjectionCalculator_MainWindow<br><font color="orange">import </font>CalculateProjectionSeries_Dialog<br><font color="orange">from </font><b><font color="orange">GENFIRE</font></b>.gui.utility <font color="orange">import </font>toString<br><br><font color="orange">class </font>ProjectionCalculator(QtGui.QMainWindow): #QDialog?<br>    model_loading_signal = QtCore.pyqtSignal()<br>    <font color="orange">def </font>__init__(self, parent=None):<br>        super(ProjectionCalculator, self).__init__()<br>        <font color="orange">self.</font>ui = ProjectionCalculator_MainWindow.Ui_ProjectionCalculator()<br>        <font color="orange">self.</font>ui.setupUi(self)<br>        <font color="orange">self.</font>calculationParameters = ProjectionCalculationParameters()<br><br>        <font color="orange">self.</font>ui.lineEdit_modelFile.setText(QtCore.QString(os.getcwd()))<br>        <font color="orange">self.</font>ui.lineEdit_modelFile.editingFinished.connect(<font color="orange">self.</font>setModelFilename_fromLineEdit)<br><br>        ## Push Buttons<br>        <font color="orange">self.</font>ui.btn_selectMo<font color="orange">del.</font>clicked.connect(<font color="orange">self.</font>selectModelFile)<br><br>        ## Sliders<br>        <font color="orange">self.</font>ui.verticalSlider_phi.setValue(0)<br>        <font color="orange">self.</font>ui.verticalSlider_phi.setMinimum(0)<br>        <font color="orange">self.</font>ui.verticalSlider_phi.setMaximum(3600)<br>        <font color="orange">self.</font>ui.verticalSlider_phi.valueChanged.connect(<font color="orange">self.</font>setPhiLineEditValue)<br><br>        <font color="orange">self.</font>ui.verticalSlider_theta.setValue(0)<br>        <font color="orange">self.</font>ui.verticalSlider_theta.setMinimum(0)<br>        <font color="orange">self.</font>ui.verticalSlider_theta.setMaximum(3600)<br>        <font color="orange">self.</font>ui.verticalSlider_theta.valueChanged.connect(<font color="orange">self.</font>setThetaLineEditValue)<br><br>        <font color="orange">self.</font>ui.verticalSlider_psi.setValue(0)<br>        <font color="orange">self.</font>ui.verticalSlider_psi.setMinimum(0)<br>        <font color="orange">self.</font>ui.verticalSlider_psi.setMaximum(3600)<br>        <font color="orange">self.</font>ui.verticalSlider_psi.valueChanged.connect(<font color="orange">self.</font>setPsiLineEditValue)<br><br>        <font color="orange">self.</font>ui.lineEdit_phi.setText(QtCore.QString('0'))<br>        <font color="orange">self.</font>ui.lineEdit_theta.setText(QtCore.QString('0'))<br>        <font color="orange">self.</font>ui.lineEdit_psi.setText(QtCore.QString('0'))<br>        <font color="orange">self.</font>ui.lineEdit_phi.editingFinished.connect(<font color="orange">self.</font>setPhiSliderValue)<br>        <font color="orange">self.</font>ui.lineEdit_theta.editingFinished.connect(<font color="orange">self.</font>setThetaSliderValue)<br>        <font color="orange">self.</font>ui.lineEdit_psi.editingFinished.connect(<font color="orange">self.</font>setPsiSliderValue)<br><br><br>        <font color="orange">self.</font>ui.btn_go.clicked.connect(<font color="orange">self.</font>calculateProjections)<br>        <font color="orange">self.</font>ui.btn_go.setEnabled(False)<br><br>        <font color="orange">self.</font>figure = plt.figure(1)<br>        <font color="orange">self.</font>figure.clf() # clear figure in case it was rendered somewhere else previously<br>        <font color="orange">self.</font>canvas = FigureCanvas(<font color="orange">self.</font>figure)<br>        <font color="orange">self.</font>navigationToolbar = NavigationToolbar(<font color="orange">self.</font>canvas, self)<br>        <font color="orange">self.</font>ui.verticalLayout_figure.addWidget(<font color="orange">self.</font>navigationToolbar)<br>        <font color="orange">self.</font>ui.verticalLayout_figure.addWidget(<font color="orange">self.</font>canvas)<br>        <font color="orange">self.</font>ax = <font color="orange">self.</font>figure.add_subplot(111)<br>        <font color="orange">self.</font>ax.axes.get_xaxis().set_visible(False)<br>        <font color="orange">self.</font>ax.axes.get_yaxis().set_visible(False)<br>        <font color="orange">self.</font>ax.hold(False)<br><br>        <font color="orange">self.</font>ui.btn_clearMo<font color="orange">del.</font>clicked.connect(<font color="orange">self.</font>clearModel)<br><br>    <font color="orange">def </font>calculateProjections(self):<br>        <font color="orange">self.</font>calculateProjections_Dialog = CalculateProjectionSeries_popup(<font color="orange">self.</font>calculationParameters)<br>        result = <font color="orange">self.</font>calculateProjections_Dialog.exec_()<br>        <font color="orange">if </font>result == QtGui.QDialog.Accepted:<br>            <font color="orange">self.</font>calculationParameters.modelFilename = toString(<font color="orange">self.</font>calculationParameters.modelFilename)<br>            <font color="orange">if </font>not <font color="orange">self.</font>calculationParameters.modelLoadedFlag:<br><br>                <font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>= <b><font color="orange">GENFIRE</font></b>.fileio.loadVolume(<font color="orange">self.</font>calculationParameters.modelFilename)<br>                <font color="orange">self.</font>calculationParameters.oversamplingRatio = <font color="orange">self.</font>calculationParameters.oversamplingRatio<br>                <font color="orange">self.</font>calculationParameters.dims = np.shape(<font color="orange">self.</font>calculationParameters.model)<br>                paddedDim = <font color="orange">self.</font>calculationParameters.dims[0] * <font color="orange">self.</font>calculationParameters.oversamplingRatio<br>                padding = int((paddedDim-<font color="orange">self.</font>calculationParameters.dims[0])/2)<br>                <font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>= np.pad(<font color="orange">self.</font>calculationParameters.model,((padding,padding),(padding,padding),(padding,padding)),'constant')<br>                <font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>= pyfftw.interfaces.numpy_fft.fftshift(pyfftw.interfaces.numpy_fft.fftn(pyfftw.interfaces.numpy_fft.ifftshift((<font color="orange">self.</font>calculationParameters.model))))<br>                <font color="orange">self.</font>calculationParameters.interpolator = <b><font color="orange">GENFIRE</font></b>.utility.getProjectionInterpolator(<font color="orange">self.</font>calculationParameters.model)<br>            <font color="orange">self.</font>calculationParameters.ncOut = np.shape(<font color="orange">self.</font>calculationParameters.model)[0]//2<br><br><br>            <font color="orange">if </font><font color="orange">self.</font>calculationParameters.angleFileProvided:<br>                <font color="orange">self.</font>calculationParameters.angleFilename = toString(<font color="orange">self.</font>calculationParameters.angleFilename)<br>                <font color="orange">self.</font>calculationParameters.outputFilename = toString(<font color="orange">self.</font>calculationParameters.outputFilename)<br>                angles = np.loadtxt(toString(<font color="orange">self.</font>calculationParameters.angleFilename))<br>                phi = angles[:, 0]<br>                theta = angles[:, 1]<br>                psi = angles[:, 2]<br>                filename = <font color="orange">self.</font>calculationParameters.outputFilename +'.npy'<br>                projections = np.zeros((<font color="orange">self.</font>calculationParameters.dims[0],<font color="orange">self.</font>calculationParameters.dims[1],np.size(phi)),dtype=float)<br>                <font color="orange">if </font><font color="orange">self.</font>calculationParameters.interpolator is None:<br>                    <font color="orange">self.</font>calculationParameters.interpolator = <b><font color="orange">GENFIRE</font></b>.utility.getProjectionInterpolator(<font color="orange">self.</font>calculationParameters.model)<br>                <font color="orange">for </font>projNum in range(0,np.size(phi)):<br>                    pj = <b><font color="orange">GENFIRE</font></b>.utility.calculateProjection_interp_fromInterpolator(<font color="orange">self.</font>calculationParameters.interpolator, phi[projNum], theta[projNum], psi[projNum], np.shape(<font color="orange">self.</font>calculationParameters.model))<br>                    projections[:, :, projNum] = pj[<font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[0]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[0]/2, <font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[1]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[1]/2]<br><br>                np.save(filename,projections)<br>            else:<br>                <font color="orange">if </font><font color="orange">self.</font>calculationParameters.interpolator is None:<br>                    <font color="orange">self.</font>calculationParameters.interpolator = <b><font color="orange">GENFIRE</font></b>.utility.getProjectionInterpolator(<font color="orange">self.</font>calculationParameters.model)<br>                phi = <font color="orange">self.</font>calculationParameters.phi<br>                psi = <font color="orange">self.</font>calculationParameters.psi<br>                theta = np.arange(<font color="orange">self.</font>calculationParameters.thetaStart, \<br>                                  <font color="orange">self.</font>calculationParameters.thetaStop, \<br>                                  <font color="orange">self.</font>calculationParameters.thetaStep)<br>                projections = np.zeros((<font color="orange">self.</font>calculationParameters.dims[0],<font color="orange">self.</font>calculationParameters.dims[1],np.size(theta)),dtype=float)<br>                <font color="orange">for </font>i, current_theta in enumerate(theta):<br><br>                    pj = <b><font color="orange">GENFIRE</font></b>.utility.calculateProjection_interp_fromInterpolator(<font color="orange">self.</font>calculationParameters.interpolator, phi, current_theta, psi, np.shape(<font color="orange">self.</font>calculationParameters.model))<br>                    projections[:, :, i] = pj[<font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[0]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[0]/2, <font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[1]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[1]/2]<br>                filename = <font color="orange">self.</font>calculationParameters.outputFilename<br>                filename = toString(filename)<br>                <b><font color="orange">GENFIRE</font></b>.fileio.saveData(filename,projections)<br>            print("Finished calculating {}.".format(filename))<br><br>    <font color="orange">def </font>clearModel(self):<br>        <font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>        = None<br>        <font color="orange">self.</font>calculationParameters.interpolator  = None<br>        <font color="orange">self.</font>calculationParameters.modelFilename = None<br>        <font color="orange">self.</font>clearFigure()<br>        <font color="orange">self.</font>ui.btn_go.setEnabled(False)<br><br>    <font color="orange">def </font>displayFigure(self):<br>        <font color="orange">if </font><font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>is not None:<br>            pj = <b><font color="orange">GENFIRE</font></b>.utility.calculateProjection_interp_fromInterpolator(<font color="orange">self.</font>calculationParameters.interpolator, <font color="orange">self.</font>calculationParameters.phi, <font color="orange">self.</font>calculationParameters.theta, <font color="orange">self.</font>calculationParameters.psi, np.shape(<font color="orange">self.</font>calculationParameters.model))<br>            pj = pj[<font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[0]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[0]/2, <font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[1]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[1]/2]<br>            <font color="orange">self.</font>showProjection(pj)<br>        else:<br>            <font color="orange">self.</font>clearFigure()<br><br>    <font color="orange">def </font>updateFigure(self):<br>        <font color="orange">if </font><font color="orange">self.</font>calculationParameters.interpolator is None:<br>            <font color="orange">self.</font>calculationParameters.interpolator = <b><font color="orange">GENFIRE</font></b>.utility.getProjectionInterpolator(<font color="orange">self.</font>calculationParameters.model)<br>        pj = <b><font color="orange">GENFIRE</font></b>.utility.calculateProjection_interp_fromInterpolator(<font color="orange">self.</font>calculationParameters.interpolator, <font color="orange">self.</font>calculationParameters.phi, <font color="orange">self.</font>calculationParameters.theta, <font color="orange">self.</font>calculationParameters.psi, np.shape(<font color="orange">self.</font>calculationParameters.model))<br>        pj = pj[<font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[0]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[0]/2, <font color="orange">self.</font>calculationParameters.ncOut-<font color="orange">self.</font>calculationParameters.dims[1]/2:<font color="orange">self.</font>calculationParameters.ncOut+<font color="orange">self.</font>calculationParameters.dims[1]/2]<br>        <font color="orange">self.</font>ax.imshow(pj)<br>        <font color="orange">self.</font>canvas.draw()<br><br><br>    <font color="orange">def </font>showProjection(self, pj):<br>        <font color="orange">self.</font>ax.imshow(pj)<br>        <font color="orange">self.</font>canvas.draw()<br><br>    <font color="orange">def </font>clearFigure(self):<br>        <font color="orange">self.</font>figure.clf()<br>        <font color="orange">self.</font>canvas.draw()<br>        <font color="orange">self.</font>ax = <font color="orange">self.</font>figure.add_subplot(111)<br>        <font color="orange">self.</font>ax.axes.get_xaxis().set_visible(False)<br>        <font color="orange">self.</font>ax.axes.get_yaxis().set_visible(False)<br>        <font color="orange">self.</font>ax.hold(False)<br><br>    <font color="orange">def </font>setPhiSliderValue(self):<br>        value = <font color="orange">self.</font>ui.lineEdit_phi.text().toFloat()[0]<br>        value = int(value * 10)<br>        <font color="orange">self.</font>ui.verticalSlider_phi.setValue(value)<br><br>    <font color="orange">def </font>setThetaSliderValue(self):<br>        value = <font color="orange">self.</font>ui.lineEdit_theta.text().toFloat()[0]<br>        value = int(value * 10)<br>        <font color="orange">self.</font>ui.verticalSlider_theta.setValue(value)<br><br>    <font color="orange">def </font>setPsiSliderValue(self):<br>        value = <font color="orange">self.</font>ui.lineEdit_psi.text().toFloat()[0]<br>        value = int(value * 10)<br>        <font color="orange">self.</font>ui.verticalSlider_psi.setValue(value)<br><br><br>    <font color="orange">def </font>setPhiLineEditValue(self, value):<br>        <font color="orange">self.</font>ui.lineEdit_phi.setText(QtCore.QString.number(float(value)/10))<br>        <font color="orange">self.</font>calculationParameters.phi = float(value)/10<br>        <font color="orange">self.</font>updateFigure()<br><br>    <font color="orange">def </font>setThetaLineEditValue(self, value):<br>        <font color="orange">self.</font>ui.lineEdit_theta.setText(QtCore.QString.number(float(value)/10))<br>        <font color="orange">self.</font>calculationParameters.theta = float(value)/10<br>        <font color="orange">self.</font>updateFigure()<br><br>    <font color="orange">def </font>setPsiLineEditValue(self, value):<br>        <font color="orange">self.</font>ui.lineEdit_psi.setText(QtCore.QString.number(float(value)/10))<br>        <font color="orange">self.</font>calculationParameters.psi = float(value)/10<br>        <font color="orange">self.</font>updateFigure()<br><br>    <font color="orange">def </font>setNumberOfProjections(self, number):<br>        <font color="orange">self.</font>calculationParameters.numberOfProjections = number.toInt()[0]<br><br>    <font color="orange">def </font>setPhiStart(self, phiStart):<br>        <font color="orange">self.</font>calculationParameters.phiStart = phiStart.toFloat()[0]<br><br>    <font color="orange">def </font>setThetaStart(self, thetaStart):<br>        <font color="orange">self.</font>calculationParameters.thetaStart = thetaStart.toFloat()[0]<br><br>    <font color="orange">def </font>setPsiStart(self, psiStart):<br>        <font color="orange">self.</font>calculationParameters.psiStart = psiStart.toFloat()[0]<br><br>    <font color="orange">def </font>setPhiStep(self, phiStep):<br>        <font color="orange">self.</font>calculationParameters.phiStep = phiStep.toFloat()[0]<br><br>    <font color="orange">def </font>setThetaStep(self, thetaStep):<br>        <font color="orange">self.</font>calculationParameters.thetaStep = thetaStep.toFloat()[0]<br><br>    <font color="orange">def </font>setPsiStep(self, psiStep):<br>        <font color="orange">self.</font>calculationParameters.psiStep = psiStep.toFloat()[0]<br><br>    <font color="orange">def </font>selectOutputDirectory(self):<br>        dirname = QtGui.QFileDialog.getExistingDirectory(QtGui.QFileDialog(), "Select File Containing Angles",options=QtGui.QFileDialog.ShowDirsOnly)<br>        <font color="orange">if </font>dirname:<br>            <font color="orange">self.</font>calculationParameters.outputFilename =  dirname<br>            # self.ui.lineEdit_outputFilename.setText(QtCore.QString(dirname))<br><br>    <font color="orange">def </font>setModelFilename_fromLineEdit(self):<br>        filename = <font color="orange">self.</font>ui.lineEdit_modelFile.text()<br>        <font color="orange">if </font>os.path.isfile(toString(filename)) and filename != <font color="orange">self.</font>calculationParameters.modelFilename:<br>            <font color="orange">self.</font>setModelFilename(toString(filename))<br><br>    <font color="orange">def </font>setModelFilename(self, filename):<br>        <font color="orange">self.</font>calculationParameters.modelFilename = filename<br>        <font color="orange">self.</font>ui.lineEdit_modelFile.setText(QtCore.QString(filename))<br>        <font color="orange">self.</font>loadModel(filename)<br>        <font color="orange">self.</font>displayFigure()<br><br>    <font color="orange">def </font>selectModelFile(self):<br>        filename = QtGui.QFileDialog.getOpenFileName(QtGui.QFileDialog(), "Select File Containing Model",filter="MATLAB files (*.mat);;TIFF images (*.t<font color="orange">if </font>*.tiff);;MRC (*.mrc);;All Files (*)")<br>        <font color="orange">if </font>os.path.isfile(toString(filename)):<br>            <font color="orange">self.</font>ui.btn_go.setEnabled(True)<br>            <font color="orange">self.</font>setModelFilename(filename)<br><br>    <font color="orange">def </font>loadModel(self, filename):<br>        <font color="orange">from </font>threading <font color="orange">import </font>Thread<br>        t = Thread(target=lambda:print("Loading Mo<font color="orange">del.</font>.."))<br>        t.start()<br>        <font color="orange">self.</font>ui.btn_go.setEnabled(True)<br>        <font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>= <b><font color="orange">GENFIRE</font></b>.fileio.loadVolume(toString(filename))<br>        <font color="orange">self.</font>calculationParameters.dims = np.shape(<font color="orange">self.</font>calculationParameters.model)<br>        <font color="orange">self.</font>calculationParameters.paddedDim = <font color="orange">self.</font>calculationParameters.dims[0] * <font color="orange">self.</font>calculationParameters.oversamplingRatio<br>        padding = int((<font color="orange">self.</font>calculationParameters.paddedDim-<font color="orange">self.</font>calculationParameters.dims[0])/2)<br>        <font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>= np.pad(<font color="orange">self.</font>calculationParameters.model,((padding,padding),(padding,padding),(padding,padding)),'constant')<br>        <font color="orange">self.</font>calculationParameters.mo<font color="orange">del </font>= pyfftw.interfaces.numpy_fft.fftshift(pyfftw.interfaces.numpy_fft.fftn(pyfftw.interfaces.numpy_fft.ifftshift((<font color="orange">self.</font>calculationParameters.model))))<br>        <font color="orange">self.</font>calculationParameters.ncOut = np.shape(<font color="orange">self.</font>calculationParameters.model)[0]//2<br>        <font color="orange">self.</font>calculationParameters.interpolator = <b><font color="orange">GENFIRE</font></b>.utility.getProjectionInterpolator(<font color="orange">self.</font>calculationParameters.model)<br>        t.join()<br><br>    <font color="orange">def </font>setAngleFilename(self, filename):<br>        <font color="orange">if </font>filename:<br>            <font color="orange">self.</font>calculationParameters.angleFilename = filename<br><br>    <font color="orange">def </font>toggleSaveProjections(self):<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.modelFilename)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.angleFilename)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.outputFilename)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.outputFilesFlag)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.phiStart)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.thetaStart)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.psiStart)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.phiStep)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.thetaStep)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.psiStep)<br>        print  (<b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.calculationParameters.numberOfProjections)<br><br><br>        <font color="orange">if </font><font color="orange">self.</font>calculationParameters.outputFilesFlag:<br>            <font color="orange">self.</font>calculationParameters.outputFilesFlag = <font color="orange">False<br></font>        else:<br>            <font color="orange">self.</font>calculationParameters.outputFilesFlag = <font color="orange">True<br></font><br>    <font color="orange">def </font>setOutputFilename(self, filename):<br>        <font color="orange">if </font>filename:<br>            <font color="orange">self.</font>calculationParameters.outputFilename = filename<br><br><br><font color="orange">class </font>ProjectionCalculationParameters:<br>    oversamplingRatio = 2<br>    <font color="orange">def </font>__init__(self):<br>        <font color="orange">self.</font>modelFilename              = QtCore.QString('')<br>        <font color="orange">self.</font>angleFilename              = QtCore.QString('')<br>        <font color="orange">self.</font>outputFilename             = QtCore.QString('')<br>        <font color="orange">self.</font>outputFilesFlag            = <font color="orange">False<br></font>        <font color="orange">self.</font>angleFileProvided          = <font color="orange">False<br></font>        <font color="orange">self.</font>modelFilenameProvided      = <font color="orange">False<br></font>        <font color="orange">self.</font>modelLoadedFlag            = <font color="orange">False<br></font>        <font color="orange">self.</font>interpolator               = None<br>        <font color="orange">self.</font>mo<font color="orange">del </font>                     = None<br>        <font color="orange">self.</font>ncOut                      = None<br>        <font color="orange">self.</font>phi                        = 0<br>        <font color="orange">self.</font>theta                      = 0<br>        <font color="orange">self.</font>thetaStart                 = 0<br>        <font color="orange">self.</font>thetaStep                  = 1<br>        <font color="orange">self.</font>thetaStop                  = 1<br>        <font color="orange">self.</font>psi                        = 0<br><br><font color="orange">class </font>CalculateProjectionSeries_popup(QtGui.QDialog):<br>    <font color="orange">def </font>__init__(self, calculation_parameters = ProjectionCalculationParameters()):<br>        super(CalculateProjectionSeries_popup, self).__init__()<br>        <font color="orange">self.</font>calculationParameters = calculation_parameters<br><br><br>        <font color="orange">self.</font>ui = CalculateProjectionSeries_Dialog.Ui_CalculateProjectionSeries_Dialog()<br>        <font color="orange">self.</font>ui.setupUi(self)<br>        <font color="orange">import </font>os<br>        <font color="orange">self.</font>ui.lineEdit_outputFilename.setText(os.path.abspath(os.getcwd()))<br>        <font color="orange">self.</font>ui.lineEdit_phi.setText(QtCore.QString(str(<font color="orange">self.</font>calculationParameters.phi)))<br>        <font color="orange">self.</font>ui.lineEdit_psi.setText(QtCore.QString(str(<font color="orange">self.</font>calculationParameters.psi)))<br>        <font color="orange">self.</font>ui.lineEdit_thetaStart.setText(QtCore.QString(str(<font color="orange">self.</font>calculationParameters.thetaStart)))<br>        <font color="orange">self.</font>ui.lineEdit_thetaStep.setText(QtCore.QString(str(<font color="orange">self.</font>calculationParameters.thetaStep)))<br>        <font color="orange">self.</font>ui.lineEdit_thetaStop.setText(QtCore.QString(str(<font color="orange">self.</font>calculationParameters.thetaStop)))<br>        <font color="orange">self.</font>ui.lineEdit_angleFile.textEdited.connect(<font color="orange">self.</font>setAngleFilename_fromLineEdit)<br>        <font color="orange">self.</font>ui.btn_selectAngleFile.clicked.connect(<font color="orange">self.</font>selectAngleFile)<br>        <font color="orange">self.</font>ui.lineEdit_phi.textEdited.connect(<font color="orange">self.</font>setPhi)<br>        <font color="orange">self.</font>ui.lineEdit_psi.textEdited.connect(<font color="orange">self.</font>setPsi)<br>        <font color="orange">self.</font>ui.lineEdit_thetaStart.textEdited.connect(<font color="orange">self.</font>setThetaStart)<br>        <font color="orange">self.</font>ui.lineEdit_thetaStep.textEdited.connect(<font color="orange">self.</font>setThetaStep)<br>        <font color="orange">self.</font>ui.lineEdit_thetaStop.textEdited.connect(<font color="orange">self.</font>setThetaStop)<br>        <font color="orange">self.</font>ui.lineEdit_outputFilename.textEdited.connect(<font color="orange">self.</font>setOutputFilename)<br><br>    <font color="orange">def </font>setAngleFilename_fromLineEdit(self):<br>        filename = <font color="orange">self.</font>ui.lineEdit_angleFile.text()<br>        <font color="orange">if </font>os.path.isfile(toString(filename)):<br>            <font color="orange">self.</font>calculationParameters.angleFilename = filename<br>            <font color="orange">self.</font>calculationParameters.angleFileProvided = <font color="orange">True<br></font>            <font color="orange">self.</font>ui.lineEdit_angleFile.setText(QtCore.QString(filename))<br>            <font color="orange">self.</font>disableAngleWidgets()<br><br>    <font color="orange">def </font>selectAngleFile(self):<br>        filename = QtGui.QFileDialog.getOpenFileName(QtGui.QFileDialog(), "Select File Containing Angles",filter="txt files (*.txt);;All Files (*)")<br>        <font color="orange">if </font>filename:<br>            <font color="orange">self.</font>calculationParameters.angleFilename = filename<br>            <font color="orange">self.</font>calculationParameters.angleFileProvided = <font color="orange">True<br></font>            <font color="orange">self.</font>ui.lineEdit_angleFile.setText(QtCore.QString(filename))<br>            <font color="orange">self.</font>disableAngleWidgets()<br><br>    <font color="orange">def </font>disableAngleWidgets(self):<br>        <font color="orange">self.</font>ui.lineEdit_thetaStart.setEnabled(True)<br>        <font color="orange">self.</font>ui.lineEdit_thetaStep.setDisabled(True)<br>        <font color="orange">self.</font>ui.lineEdit_thetaStop.setDisabled(True)<br>        <font color="orange">self.</font>ui.lineEdit_phi.setDisabled(True)<br>        <font color="orange">self.</font>ui.lineEdit_psi.setDisabled(True)<br><br>        <font color="orange">self.</font>ui.lineEdit_thetaStart.setStyleSheet("background-color: gray")<br>        <font color="orange">self.</font>ui.lineEdit_thetaStep.setStyleSheet("background-color: gray")<br>        <font color="orange">self.</font>ui.lineEdit_thetaStop.setStyleSheet("background-color: gray")<br>        <font color="orange">self.</font>ui.lineEdit_phi.setStyleSheet("background-color: gray")<br>        <font color="orange">self.</font>ui.lineEdit_psi.setStyleSheet("background-color: gray")<br><br>    <font color="orange">def </font>setPhi(self, angle):<br>        <font color="orange">self.</font>calculationParameters.phi = angle.toFloat()[0]<br><br>    <font color="orange">def </font>setPsi(self, angle):<br>        <font color="orange">self.</font>calculationParameters.psi = angle.toFloat()[0]<br><br>    <font color="orange">def </font>setThetaStart(self, value):<br>        <font color="orange">self.</font>calculationParameters.thetaStart = value.toFloat()[0]<br><br>    <font color="orange">def </font>setThetaStep(self, value):<br>        <font color="orange">self.</font>calculationParameters.thetaStep = value.toFloat()[0]<br><br>    <font color="orange">def </font>setThetaStop(self, value):<br>        <font color="orange">self.</font>calculationParameters.thetaStop = value.toFloat()[0]<br><br>    <font color="orange">def </font>setOutputFilename(self, filename):<br>        <font color="orange">if </font>filename:<br>            <font color="orange">self.</font>calculationParameters.outputFilename = filename<br><br><font color="orange">if </font>__name__ == "__main__":<br>    <font color="orange">import </font>sys<br><br>    # Startup the application<br>    app = QtGui.QApplication(sys.argv)<br><br>    # app.setStyle('plastique')<br>    app.setStyle('mac')<br><br>    # Create the GUI<br>    <b><font color="orange">GENFIRE</font></b>_ProjectionCalculator = ProjectionCalculator()<br><br>    # Render the GUI<br>    <b><font color="orange">GENFIRE</font></b>_ProjectionCalculator.show()<br><br>    sys.exit(app.exec_())<br><br></code></body>
    </html>